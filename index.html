123<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç webhook n8n –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ –ë–∏—Ç—Ä–∏–∫—Å</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 700px; margin: 40px auto; padding: 20px; background: #f9f9f9; }
        h1 { color: #333; text-align: center; }
        form { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        label { display: block; margin: 15px 0 5px; font-weight: bold; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { margin-top: 20px; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1em; }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        .info { margin-top: 30px; font-size: 0.9em; color: #666; }
        .results { margin-top: 40px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: none; }
        .results h2 { color: #28a745; margin-top: 0; text-align: center; }
        .loading { text-align: center; color: #007bff; font-style: italic; margin: 20px 0; }
        .response-content { margin-top: 20px; line-height: 1.6; }
        .file-card {
            display: flex;
            align-items: center;
            background: #f0f4f8;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .file-icon { font-size: 40px; margin-right: 15px; color: #4a90e2; }
        .file-info { flex-grow: 1; }
        .file-name { font-weight: bold; display: block; margin-bottom: 5px; color: #333; }
        .download-btn {
            background: #28a745; color: white; text-decoration: none;
            padding: 8px 15px; border-radius: 4px; font-size: 0.9em;
            display: inline-block; transition: background-color 0.2s;
        }
        .download-btn:hover { background: #218838; }
        .error-message {
            color: #d93025; background: #f8d7da; padding: 15px;
            border: 1px solid #f5c6cb; border-radius: 4px; margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç–∏—Ä—É–µ–º webhook n8n</h1>
    <p>–û—Ç–ø—Ä–∞–≤—å –∫–æ–Ω—Ç–µ–Ω—Ç ‚Äî –ø–æ–ª—É—á–∏ –≥–æ—Ç–æ–≤—ã–µ JSON-—Ñ–∞–π–ª—ã –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü –ë–∏—Ç—Ä–∏–∫—Å–∞.</p>
   
    <form id="testForm" action="https://n8n.takfit.ru/webhook-test/content-to-bitrix" method="POST" enctype="multipart/form-data">
        <!-- <form id="testForm" action="https://vanish74.app.n8n.cloud/webhook-test/content-to-bitrix" method="POST" enctype="multipart/form-data"> -->
        <label for="input_type">–¢–∏–ø –≤–≤–æ–¥–∞:</label>
        <select name="input_type" id="input_type" required>
            <option value="url">URL (—Å—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É)</option>
            <option value="pdf">PDF-—Ñ–∞–π–ª</option>
            <option value="text">–¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª</option>
        </select>
      
        <label for="content">–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:</label>
        <input type="text" name="content" id="content_url" placeholder="–í–≤–µ–¥–∏ URL, –Ω–∞–ø—Ä–∏–º–µ—Ä https://example.com" required>
        <input type="file" name="content" id="content_file" style="display:none;" accept=".pdf,.txt">
        
        <!-- –°–µ–ª–µ–∫—Ç –ê—Å–ø—Ä–æ ‚Äî —Ç–µ–ø–µ—Ä—å —Å id –∏ label –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ -->
        <label for="aspro_solution">–†–µ—à–µ–Ω–∏–µ –ê—Å–ø—Ä–æ:</label>
        <select name="aspro_solution" id="aspro_solution" required style="width: 100%; padding: 10px; margin: 15px 0; font-size: 16px; border-radius: 6px; border: 1px solid #ccc;">
            <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ –ê—Å–ø—Ä–æ</option>
            <option value="–ê—Å–ø—Ä–æ: –ü—Ä–µ–º—å–µ—Ä">–ê—Å–ø—Ä–æ: –ü—Ä–µ–º—å–µ—Ä</option>
            <option value="–ê—Å–ø—Ä–æ: –ú–∞–∫—Å–∏–º—É–º">–ê—Å–ø—Ä–æ: –ú–∞–∫—Å–∏–º—É–º</option>
            <option value="–ê—Å–ø—Ä–æ: –õ–∞–π—Ç—à–æ–ø">–ê—Å–ø—Ä–æ: –õ–∞–π—Ç—à–æ–ø</option>
            <option value="–ê—Å–ø—Ä–æ: –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —Å–∞–π—Ç 3.0">–ê—Å–ø—Ä–æ: –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —Å–∞–π—Ç 3.0</option>
            <option value="–ê—Å–ø—Ä–æ: –ü—Ä–∏–æ—Ä–∏—Ç–∏ 2.0">–ê—Å–ø—Ä–æ: –ü—Ä–∏–æ—Ä–∏—Ç–∏ 2.0</option>
        </select>
        
        <button type="submit" id="submitBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å</button>
    </form>
   
    <div class="info">
        <p>–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –Ω–∏–∂–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>
        <p>–ï—Å–ª–∏ –≤—ã–±—Ä–∞–ª URL ‚Äî –∑–∞–ø–æ–ª–Ω–∏ –ø–æ–ª–µ. –ï—Å–ª–∏ PDF –∏–ª–∏ —Ç–µ–∫—Å—Ç ‚Äî –≤—ã–±–µ—Ä–∏ —Ñ–∞–π–ª.</p>    
    </div>
   
    <div class="results" id="results" style="display:none;">
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏</h2>
        <div class="loading" id="loading">–û–±—Ä–∞–±–æ—Ç–∫–∞... —ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –¥–æ 5 –º–∏–Ω—É—Ç ‚åõ</div>
        <div class="response-content" id="responseContent"></div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const inputTypeSelect = document.getElementById('input_type');
            const urlInput = document.getElementById('content_url');
            const fileInput = document.getElementById('content_file');

            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
            inputTypeSelect.addEventListener('change', function() {
                const type = this.value;
                if (type === 'url') {
                    urlInput.style.display = 'block';
                    urlInput.required = true;
                    fileInput.style.display = 'none';
                    fileInput.required = false;
                } else {
                    urlInput.style.display = 'none';
                    urlInput.required = false;
                    fileInput.style.display = 'block';
                    fileInput.required = true;
                    fileInput.accept = type === 'pdf' ? '.pdf' : '.txt';
                }
            });

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é URL
            inputTypeSelect.dispatchEvent(new Event('change'));

            const form = document.getElementById('testForm');
            const submitBtn = document.getElementById('submitBtn');
            const resultsDiv = document.getElementById('results');
            const loadingDiv = document.getElementById('loading');
            const responseContentDiv = document.getElementById('responseContent');

            form.addEventListener('submit', async function(e) {
                e.preventDefault();
              
                submitBtn.disabled = true;
                submitBtn.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞...';
                resultsDiv.style.display = 'block';
                loadingDiv.style.display = 'block';
                responseContentDiv.innerHTML = '';

                const formData = new FormData(form);  // ‚Üê —Å—é–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–∞–¥—ë—Ç aspro_solution

                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 300000);

                try {
                    const response = await fetch(form.action, {
                        method: 'POST',
                        body: formData,
                        signal: controller.signal,
                        headers: {
                            'Accept': 'application/zip'
                        }
                    });

                    clearTimeout(timeoutId);

                    const contentType = response.headers.get('Content-Type') || '';
                    if (!response.ok) {
                        const text = await response.text();
                        throw new Error(`–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É ${response.status}: ${text.slice(0, 200)}...`);
                    }

                    if (!contentType.includes('zip') && !contentType.includes('octet-stream')) {
                        const text = await response.text();
                        if (text.trim().startsWith('<!DOCTYPE html>') || text.includes('Cloudflare') || response.status === 524) {
                            throw new Error('–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç Cloudflare (~100 —Å–µ–∫—É–Ω–¥). n8n.cloud –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–ª—å—à–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å webhook. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π workflow –∏–ª–∏ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏ self-hosted –≤–µ—Ä—Å–∏—é.');
                        }
                        throw new Error('–ü–æ–ª—É—á–µ–Ω –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ç–∏–ø –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞.');
                    }

                    const arrayBuffer = await response.arrayBuffer();
                    const blob = new Blob([arrayBuffer], { type: 'application/zip' });
                    let filename = 'bitrix_pages.zip';
                    const disposition = response.headers.get('Content-Disposition');
                    if (disposition) {
                        const match = disposition.match(/filename\*?=([^;]+|"([^"]+)")/i);
                        if (match) {
                            filename = match[2] || match[1];
                            filename = decodeURIComponent(filename.replace(/["']/g, ''));
                        }
                    }
                    if (!filename.endsWith('.zip')) filename += '.zip';

                    const fileUrl = URL.createObjectURL(blob);
                    responseContentDiv.innerHTML = `
                        <div class="file-card">
                            <div class="file-icon">üì¶</div>
                            <div class="file-info">
                                <span class="file-name">${filename}</span>
                                <a href="${fileUrl}" download="${filename}" class="download-btn">–°–∫–∞—á–∞—Ç—å –∞—Ä—Ö–∏–≤</a>
                            </div>
                        </div>
                    `;

                } catch (err) {
                    if (err.name === 'AbortError') {
                        responseContentDiv.innerHTML = `<div class="error-message"><b>–¢–∞–π–º–∞—É—Ç:</b> –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–Ω—è–ª–∞ –±–æ–ª—å—à–µ 5 –º–∏–Ω—É—Ç.</div>`;
                    } else {
                        responseContentDiv.innerHTML = `<div class="error-message"><b>–û—à–∏–±–∫–∞:</b> ${err.message}</div>`;
                    }
                    console.error(err);
                } finally {
                    loadingDiv.style.display = 'none';
                    submitBtn.disabled = false;
                    submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å';
                }
            });
        });
    </script>
</body>
</html>