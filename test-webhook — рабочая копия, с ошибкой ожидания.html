<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç webhook n8n –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ –ë–∏—Ç—Ä–∏–∫—Å</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 700px; margin: 40px auto; padding: 20px; background: #f9f9f9; }
        h1 { color: #333; text-align: center; }
        form { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        label { display: block; margin: 15px 0 5px; font-weight: bold; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { margin-top: 20px; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1em; }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }

        .info { margin-top: 30px; font-size: 0.9em; color: #666; }

        .results { margin-top: 40px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: none; }
        .results h2 { color: #28a745; margin-top: 0; text-align: center; }
        .loading { text-align: center; color: #007bff; font-style: italic; margin: 20px 0; }
        .response-content { margin-top: 20px; line-height: 1.6; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏ —Ñ–∞–π–ª–∞ */
        .file-card {
            display: flex;
            align-items: center;
            background: #f0f4f8;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .file-icon {
            font-size: 40px;
            margin-right: 15px;
            color: #4a90e2;
        }
        .file-info {
            flex-grow: 1;
        }
        .file-name {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
            color: #333;
        }
        .download-btn {
            background: #28a745;
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 4px;
            font-size: 0.9em;
            display: inline-block;
            transition: background-color 0.2s;
        }
        .download-btn:hover { background: #218838; }

        .error-message {
            color: #d93025;
            background: #f8d7da;
            padding: 10px;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
        }

    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç–∏—Ä—É–µ–º webhook n8n</h1>
    <p>–û—Ç–ø—Ä–∞–≤—å –∫–æ–Ω—Ç–µ–Ω—Ç ‚Äî –ø–æ–ª—É—á–∏ –≥–æ—Ç–æ–≤—ã–µ JSON-—Ñ–∞–π–ª—ã –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü –ë–∏—Ç—Ä–∏–∫—Å–∞.</p>

    <form id="testForm" action="https://vanish74.app.n8n.cloud/webhook-test/content-to-bitrix" method="POST" enctype="multipart/form-data">
        <label for="input_type">–¢–∏–ø –≤–≤–æ–¥–∞:</label>
        <select name="input_type" id="input_type" required>
            <option value="url">URL (—Å—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É)</option>
            <option value="pdf">PDF-—Ñ–∞–π–ª</option>
            <option value="text">–¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª</option>
        </select>

        <label for="content">–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:</label>
        <input type="text" name="content" id="content_url" placeholder="–í–≤–µ–¥–∏ URL, –Ω–∞–ø—Ä–∏–º–µ—Ä https://example.com" required>
        <input type="file" name="content" id="content_file" style="display:none;" accept=".pdf,.txt">

        <button type="submit" id="submitBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å</button>
    </form>

    <div class="info">
        <p>–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –Ω–∏–∂–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>
        <p>–ï—Å–ª–∏ –≤—ã–±—Ä–∞–ª URL ‚Äî –∑–∞–ø–æ–ª–Ω–∏ –ø–æ–ª–µ. –ï—Å–ª–∏ PDF –∏–ª–∏ —Ç–µ–∫—Å—Ç ‚Äî –≤—ã–±–µ—Ä–∏ —Ñ–∞–π–ª.</p>
    </div>

    <!-- –ë–ª–æ–∫ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ -->
    <div class="results" id="results">
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏</h2>
        <div class="loading" id="loading">–û–±—Ä–∞–±–æ—Ç–∫–∞... –ø–æ–¥–æ–∂–¥–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥</div>
        <div class="response-content" id="responseContent"></div>
    </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const inputTypeSelect = document.getElementById('input_type');
        const urlInput = document.getElementById('content_url');
        const fileInput = document.getElementById('content_file');

        // --- –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ ---
        inputTypeSelect.addEventListener('change', function() {
            const type = this.value;
            if (type === 'url') {
                urlInput.style.display = 'block';
                urlInput.required = true;
                fileInput.style.display = 'none';
                fileInput.required = false;
            } else {
                urlInput.style.display = 'none';
                urlInput.required = false;
                fileInput.style.display = 'block';
                fileInput.required = true;
                fileInput.accept = type === 'pdf' ? '.pdf' : '.txt';
            }
        });

        // --- –õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞ ---
        const form = document.getElementById('testForm');
        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitBtn = document.getElementById('submitBtn');
            const resultsDiv = document.getElementById('results');
            const loadingDiv = document.getElementById('loading');
            const responseContentDiv = document.getElementById('responseContent');

            submitBtn.disabled = true;
            submitBtn.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞...';
            resultsDiv.style.display = 'block';
            loadingDiv.style.display = 'block';
            responseContentDiv.innerHTML = '';

            const formData = new FormData(form);

            try {
                const response = await fetch(form.action, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/zip'  // –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –∂–¥—ë–º –∞—Ä—Ö–∏–≤
                    }
                });

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status} ${response.statusText}`);
                }

                // –ù–∞–¥—ë–∂–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–∏—Ç—å —á–∏—Å—Ç—ã–π binary
                const arrayBuffer = await response.arrayBuffer();
                const blob = new Blob([arrayBuffer], { type: 'application/zip' });

                // –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
                const disposition = response.headers.get('Content-Disposition');
                let filename = "bitrix_pages.zip"; // –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
                if (disposition) {
                    const match = disposition.match(/filename\*?=([^;]+|"([^"]+)")/i);
                    if (match) {
                        filename = match[2] || match[1];
                        filename = decodeURIComponent(filename.replace(/["']/g, ''));
                    }
                }
                // –ï—Å–ª–∏ –∏–º—è –ø—É—Å—Ç–æ–µ –∏–ª–∏ –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è ‚Äî —Ñ–æ—Ä—Å–∏—Ä—É–µ–º
                if (!filename.endsWith('.zip')) {
                    filename = filename.replace(/\.[^/.]+$/, "") + ".zip"; // –∑–∞–º–µ–Ω—è–µ–º —Å—Ç–∞—Ä–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏–ª–∏ –¥–æ–±–∞–≤–ª—è–µ–º
                }

                // –°–æ–∑–¥–∞—ë–º —Å—Å—ã–ª–∫—É –Ω–∞ blob
                const fileUrl = window.URL.createObjectURL(blob);

                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç–æ—á–∫—É
                responseContentDiv.innerHTML = `
                    <div class="file-card">
                        <div class="file-icon">üì¶</div>
                        <div class="file-info">
                            <span class="file-name">${filename}</span>
                            <a href="${fileUrl}" download="${filename}" class="download-btn">–°–∫–∞—á–∞—Ç—å –∞—Ä—Ö–∏–≤</a>
                        </div>
                    </div>
                `;

            } catch (err) {
                responseContentDiv.innerHTML = `<div class="error-message"><b>–û—à–∏–±–∫–∞:</b> ${err.message}</div>`;
                console.error(err);
            } finally {
                loadingDiv.style.display = 'none';
                submitBtn.disabled = false;
                submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å';
            }
        });
    });
</script>


</body>
</html>
